// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Device table - Suprema gate devices
model Device {
  id               Int       @id @default(autoincrement()) @db.UnsignedInt
  name             String?   @db.VarChar(191)
  ip               String?   @db.VarChar(191)
  username         String?   @db.VarChar(191)
  password         String?   @db.VarChar(191)
  loc              String?   @db.VarChar(191)
  channel          Int?      @db.UnsignedTinyInt
  last_event_sync  DateTime  @default(now())
  last_user_sync   DateTime  @default(now())

  // Relations
  gateEvents       GateEvent[]

  @@map("device")
}

// Gate Events table - Access control events from devices
model GateEvent {
  id               Int       @id @default(autoincrement()) @db.UnsignedInt
  employee_id      String?   @db.Char(20)
  door_no          Int?      @db.UnsignedInt
  gate_id          Int?      @db.UnsignedInt
  loc              String?   @db.Char(15)
  dir              String?   @db.Char(5)
  etime            DateTime?
  etime_truncated  String?   @db.VarChar(16)
  d                DateTime? @db.Date
  t                DateTime? @db.Time(0)

  // Relations
  device           Device?   @relation(fields: [gate_id], references: [id])

  @@index([gate_id])
  @@index([employee_id])
  @@index([etime])
  @@map("gateevents")
}

// User table - System users (for authentication)
model User {
  id           Int     @id @default(autoincrement())
  username     String  @db.VarChar(300)
  userpassword String  @db.VarChar(300)
  displayname  String  @db.VarChar(300)

  @@map("user")
}

// Temporary Access table - Guest/temporary access management
model TempAccess {
  id            Int      @id @default(autoincrement()) @db.UnsignedInt
  solutionnname String?  @db.VarChar(191)
  person_name   String?  @db.VarChar(191)
  date          String?  @db.VarChar(191)
  qrcode        Float?   @db.Double
  email         String?  @db.VarChar(191)
  drive_id      String?  @db.VarChar(100)
  done          Boolean  @default(false) @db.TinyInt
  host          String?  @db.VarChar(5000)
  ts            DateTime @default(now())

  @@map("tempaccess")
}

// Employee view - Read-only view for employee data
// Note: This is a database view, not a table. Prisma doesn't support views natively,
// so we model it as a table with @@ignore to prevent migrations
model Employee {
  id                      Int       @id @db.UnsignedInt
  username                String?   @db.VarChar(191)
  userpassword            String?   @db.VarChar(191)
  displayname             String?   @db.VarChar(191)
  jobtitle                String?   @db.VarChar(191)
  jobtype                 String?   @db.VarChar(191)
  startdate               DateTime? @db.Date
  start_contract_date     DateTime? @db.Date
  end_contract_date       DateTime? @db.Date
  contract_duration_months Float?   @db.Double
  terminationdate         DateTime?
  terminationreason       String?   @db.MediumText
  salary                  Decimal?  @db.Decimal(10, 2)
  payment_way             String?   @db.VarChar(100)
  bankaccount             String?   @db.VarChar(150)
  bankcode                String?   @db.VarChar(50)
  ssn                     String?   @db.VarChar(191)
  officialemail           String?   @db.VarChar(300)
  departmentid            String?   @db.VarChar(100)
  workingtime             String?   @db.VarChar(191)
  grade                   Int?      @db.UnsignedTinyInt
  rank                    Int?      @db.UnsignedInt
  hrank                   Int?
  latestdegree            String?   @db.VarChar(255)
  referral                String?   @db.VarChar(191)
  hearabout               String?   @db.VarChar(191)
  submitted               String?   @db.VarChar(191)
  submitiondate           String?   @db.VarChar(191)
  accepted                String?   @db.VarChar(191)
  contacted               String?   @db.VarChar(191)
  finalstatus             String?   @db.VarChar(191)
  harmonyfinalstatus      String?   @db.VarChar(191)
  ivyfinalstatus          String?   @db.VarChar(191)
  haccepted               Int?      @db.UnsignedTinyInt
  hnotes                  String?   @db.VarChar(191)
  notes                   String?   @db.MediumText
  staffnotes              String?   @db.MediumText
  hasvisa                 String?   @db.VarChar(50)
  suspend                 String?   @db.VarChar(10)
  borroweditems           String?   @db.VarChar(500)
  driveid                 String?   @db.Text
  employeephoto           String?   @db.VarChar(191)
  baseimage               String?   @db.LongText
  company_id              Int?
  absfactor               Decimal?  @db.Decimal(10, 0)
  absdays                 Int?

  @@map("employee")
  @@ignore
}

// AllEmployees view - Read-only view for all employees with extended data
// Note: This is a database view, modeled with @@ignore to prevent migrations
model AllEmployees {
  id                  Int       @id @db.UnsignedInt
  firstname           String?   @db.VarChar(191)
  middlename          String?   @db.VarChar(191)
  lastname            String?   @db.VarChar(191)
  fullname            String?   @db.Text
  displayname         String?   @db.VarChar(191)
  gender              String?   @db.VarChar(191)
  dateofbirth         DateTime? @db.Date
  native              String?   @db.VarChar(191)
  email               String?   @db.VarChar(191)
  mobile              String?   @db.VarChar(397)
  jobtitle            String?   @db.VarChar(191)
  startdate           DateTime? @db.Date
  terminationdate     DateTime?
  terminationreason   String?   @db.MediumText
  salary              Decimal?  @db.Decimal(10, 2)
  payment_way         String?   @db.VarChar(100)
  bankaccount         String?   @db.VarChar(150)
  bankcode            String?   @db.VarChar(50)
  ssn                 String?   @db.VarChar(191)
  officialemail       String?   @db.VarChar(300)
  rank                Int?      @db.UnsignedInt
  hrank               Int?
  latestdegree        String?   @db.VarChar(255)
  submitted           String?   @db.VarChar(191)
  contacted           String?   @db.VarChar(191)
  finalstatus         String?   @db.VarChar(191)
  harmonyfinalstatus  String?   @db.VarChar(191)
  ivyfinalstatus      String?   @db.VarChar(191)
  hnotes              String?   @db.VarChar(191)
  notes               String?   @db.MediumText
  staffnotes          String?   @db.MediumText
  hasvisa             String?   @db.VarChar(50)
  suspend             String?   @db.VarChar(10)
  borroweditems       String?   @db.VarChar(500)
  card                String?   @db.VarChar(255)
  driveid             String?   @db.Text
  company             String?   @db.VarChar(500)
  company_id          Int?
  absfactor           Decimal?  @db.Decimal(10, 0)
  appointments        String?   @db.LongText
  happointments       String?   @db.LongText
  harmonyppointments  String?   @db.LongText
  ivyappointments     String?   @db.LongText
  jobs                String?   @db.LongText
  dates               String?   @db.LongText

  @@map("allemployees")
  @@ignore
}

// MailTemplates Body view - Read-only view for email templates
model MailTemplatesBody {
  id   Int     @id
  dir  String? @db.VarChar(3)
  body String? @db.MediumText

  @@map("mailtemplates_body")
  @@ignore
}